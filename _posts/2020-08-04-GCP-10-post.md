---
title: Google Cloud - Compute Engine
date : 2020-08-04 14:33:30 -0400
categories : Google Cloud GCP
---


#### 1. Compute Engine
* 정의 : GCP에서 제공하는 가상머신 서비스이다, GCP에서 가장 기본적이면서 많이 쓰이는 인프라로 네트워크에 연결된 가상서버를 제공하며, 전세계에 위치한 데이터 센터들은 광섬유 네트워크로 연결이 되어 있기 때문에 당일 인스턴스에서 글로벌 부하 분산 클라우드 컴퓨팅으로 확장할 수 있다.
* 특징
    + 다양한 인스턴스 구성 및 이미지를 제공한다.
    + 소프트웨어 또는 업데이트 와 같은 호스트 시스템 이벤트가 발생하더라도, VM인스턴스가 계속 실행될 수 있게 해주는 라이브 이전 기능을 제공한다.
    + Compute Engine에 있는 선점형 VM은 GCP에 있는 유후자원을 활용하여 매우 저렴한 가격으로 컴퓨팅 리소스를 이용할 수 있다.
    + 상대적으로 저렴한 비용으로 이용할 수 있다.
    + 구글 쿠버네티스 엔진(Google Kubernetes Engine)을 통해서 Compute Engine VM에서 도커 컨테이너를 실행 및 관리, 조정할 수 있다.



#### 2. VM인스턴스
* Compute Engine 인스턴스에서는 리눅스 및 윈도우 서버용 공개이미지뿐만 아니라, 사용자가 만들거나 사용자의 기존 시스템에서 가져올 수 있는 비공개 커스텀 이미지도 실행할 수 있다.
* 인스턴스는 프로젝트에 포함이 되어 있기 때문에 프로젝트를 삭제하면 여기에 속한 인스턴스도 함께 삭제된다.
* 인스턴스는 운영체제가 포함된 작은 부팅 영구디스크를 가지고 있으며, 만약 더 많은 저장공간이 필요한 경우에는 Repository옵션을 통해서 저장공간을 추가할 수 있다.
* 프로젝트에는 최대 5개의 VPC네트워크를 가질 수 있으며, Compute Engine 인스턴스는 하나의 VPC 네트워크에 속하게 되고 동일한 네트워크안에 위치한 인스턴스들을 로컬영역 네트워크 프로트콜로 서로 통신할 수 있다.
* Compute Engine은 인스턴스를 만들때 컨테이너를 사용하여 만들 수 있는 옵션을 지원하기 때문에 VM 또는 인스턴스 템플릿을 만들때 도커이미지로 시작할 수 있다.



#### 3. 머신유형
* 메모리, vCPU, 디스크등을 포함하여 인스턴스에 제공할 수 있는 가상화된 하드웨어 리소스 모음을 지정한다, 이렇게 되면 머신유형의 조합을 통해서 나에게 맞는 최적의 머신을 만들 수 있다.
* 사전 정의된 머신유형 : Compute Engine에서는 정의한 머신유형이 있는데, 자신의 목적에 맞는 유형을 선택하면 되고 생성된 이후에도 언제든 머신유형은 변경할 수 있다.
* 커스텀 머신유형 : 사전 정의된 머신유형이 맞지않을 경우, 인스턴스 생성시 사용할 vCPU 수와 메모리 용량등 머신유형을 설정할 수 있다, 대신 사전 정의된 머신유형보다 비용이 약간 추가되며 선택 가능한 메모리 및 vCPU에 일부 제한이 있을 수 있다.
* CPU플렛폼 : Compute Engine에서 VM인스턴스가 사용할 수 있는 CPU플렛폼중 하나를 사용하게 되고 CPU플렛폼을 직접 지정하지 않으면, 기본적으로 설정되어있는 기본 플렛폼을 사용한다.
* Compute Engine의 GPU : Compute Engine에서는 VM에 추가할 수 있는 GPU를 제공하고 이러한 GPU를 사용하면 머신러닝 및 데이터 처리와 같은 특정부하작업에 효율을 가져올 수 있다, 또 3D 시각화 및 3D 렌터링 같은 그래픽 집약적인 부하가 있는 경우에 NVIDIA GRID기술을 사용하는 가상워크스테이션을 만들 수 있다.
* 이미지 : Compute Engine에서는 구글에서 제공하는 운영체제 이미지를 사용하여 인스턴스의 부팅디스크를 만들 수 있고, 두가지의 유형으로 나뉘는 데 공개이미지와 커스텀이미지가 있다. 대부분 공개이미지는 추가비용이 없지만 프리미엄이미지는 추가비용이 발생하고 커스텀이미지는 유지하는 추가비용이 발생한다.
    + 공개이미지 : 구글, 오픈소스커뮤니티, 제조사 공급업체에서 제공하고 관리한다.
    + 커스텀이미지 : 사용자의 프로젝트에서만 사용할 수 있는 이미지로 부팅디스크 및 다른 이미지에서 커스텀이미지를 생성한 다음에 해당 이미지를 이용하여 인스턴스를 만들수 있다.



#### 4. 실시간 이전(Live Migration)
* Compute Engine은 소프트웨어 또는 하드웨어 업데이트와 같은 호스트 시스템 이벤트가 발생하더라도 인스턴스를 종료 및 재부팅할 필요없이 계속 실행시키는 실시간 이전이라는 기능을 제공한다.
* 사용자가 VM을 재부팅할 필요성이 동일영역에서 실행중인 인스턴스를 또다른 호스트로 라이브이전한다, 이를 통해서 사용자의 VM에 영향을 주지 않으면서도 인프라를 보호하고 안정적인 상태로 유지하는데 반드시 필요한 유지관리를 할 수 있다.
* 하드웨어가 완전히 고장나거나 하는 이유로 실시간 이전이 불가능한 경우에는 VM이 다운된 후에 자동으로 다시시작되고 호스트에러(HostError)가 로깅된다.
* 실시간 이전은 VM자체의 어떠한 속성도 변경하지 않는다.



#### 5. 선점형 VM 인스턴스 
* GCP내에서 아무도 사용하고 있지않는 리소스를 사용함으로써 일관 인스턴스보다 저렴한 가격으로 만들고, 실행할 수 있는 인스턴스이다.
* 다음의 제약사항이 존재한다.
    + Compute Engine은 시스템 이벤트가 발생하면 언제든 선점형 인스턴스를 종료할 수 있다.
    + Compute Engine은 언제나 선점형 인스턴스를 24시간동안 실행한 후 종료한다.
    + 선점형 인스턴스는 한정된 Compute Engine은 리소스이므로 사용하지 못할 수 있다.
    + 선점형 인스턴스는 유지관리 이벤트 발생시 'Live Migration'을 지원하지 않는다.
    + 이러한 제약사항 때문에 'Google Compute Engine SLA'에서 제외한다.



#### 6. 인스턴스 템플릿
* VM인스턴스 및 인스턴스 그룹을 만드는 데 사용할 수 있는 리소스이다.
* 머신유형, 부팅디스크 이미지 또는 컨테이너 이미지, 영역, 라벨, 그외의 속성등을 이용하여 템플릿을 만들고 이를 통해서 관리형 인스턴스 그룹이나 개별 VM 인스턴스를 만들 수 있다.
* 가장 큰 목적은 동일한 구성의 인스턴스를 여러개 만들기 위해서 이다, 따라서 기존 인스턴스 템플릿을 변경할 수 없다.
* 지역이나 영역에 영향을 받지않는 글로벌 리소스이지만, 인스턴스 템플릿 옵션중 '영역리소스'를 지정한다면 해당리소스가 있는 영역으로 템플릿 사용을 제한할 수 있다.



#### 7. 인스턴스 그룹
* 정의 : 프로젝트의 각 인스턴스를 개별적으로 제어할 필요가 없도록 VM인스턴스 그룹을 만들고 관리할 수 있다, 크게 관리형 인스턴스 그룹과 비관리형 인스턴스 그룹이라는 2가지 인스턴스 그룹 유형을 사용할 수 있다.
* 관리형 인스턴스 그룹 : 인스턴스 템플릿을 사용하여 동일한 인스턴스 그룹을 만들 수 있다.
    + 별다른 설정 없이도 자동으로 오토스케일링을 지원한다.
    + 부하 분산 서비스인 로드벨런서(Load Balancer)를 붙여서 그룹의 모든 인스턴스에 트래픽을 분산할 수 있다.
    + 관리형 인스턴스 그룹은 크게 2가지 유형으로 구성할 수 있는 데, 하나는 단일영역에 인스턴스를 배포하는 영역 관리형 인스턴스 그룹과 동일 리전내 여러영역에 배포하는 리전 관리형 인스턴스 그룹이 있다.
    + 리전 관리형 인스턴스 그룹은 애플리케이션의 부하를 여러영역에 분산시켜 보다 높은 가용성을 제공한다.
    + 관리형 인스턴스 그룹의 인스턴스들은 디폴트 네트워크에 배치가 되며 리전 범위에서 임의의 IP주소가 할당 된다, 만약에 더 작은 IP범위를 사용하고자 한다면, 커스텀모드 VPC네트워크와 서브넷을 만든 다음 인스턴스 템플릿에 지정하여 그룹의 IP범위를 제한할 수 있다.
    + 컨테이너를 이용하여 애플리케이션의 배포를 간소화할 수 있다.
* 비관리형 인스턴스 그룹 : 관리형 인스턴스 그룹과 다르게 임의로 다른 구성을 가진 인스턴스를 추가하거나 제어할 수 있다, 대신에 오토스케일링, 자동 복구, 롤링 업데이트 지원, 인스턴스 템플릿 사용은 제공하지 않는다.



#### 8. 전역(Global), 영역(Region)과 지역(Zone)
* GCP리소스는 전 세계 여러위치에서 호스팅이 된다, 이러한 위치는 전역과 지역, 그지역에서는 여러 영역으로 구성되며, 모든 Compute Engine리소스는 전역, 지역, 영역 리소스이다.
* 전역리소스 : 동일한 프로젝트 내의 모든영역에 있는 모든 리소스가 액세스할 수 있다, 전역리소스를 만들 때는 범위 사양을 지정하지 않아도 된다.
    + 주소(Address) : 전역 정적 외부 IP주소는 전역리소스이며 HTTP(S), SSL Proxy, TCP Proxy 와 같은 전역 부하 분산 장치에 사용할 수 있다.
    + 이미지(Images) : 이미지는 모든 인스턴스 또는 디스크리소스에서 사용할 수 있다.
    + 스냅샷(Snapshots) : 영구디스크 스냅샷은 스냅샷과 동일한 프로젝트 내의 모든 디스크에서 사용할 수 있다.
    + 인스턴스 템플릿 : 인스턴스 템플릿은 전역리소스 이지만, 인스턴스 템플릿에서 영역리소스를 지정할 수 있으며, 이경우 영역리소스가 있는 영역으로 템플릿 사용이 제한된다.
    + VPC네트워크 : VPC네트워크는 전역리소스 이지만, 개별 서브넷은 지역리소스이다.
    + 방화벽 : 단일 네트워크에 적용되지만, 패킷이 다른 네트워크에서 방화벽에 도달할 수 있기 때문에 전역리소스로 간주된다.
    + 경로 : 이용하면 라우터가 로컬영역 네트워크내에서 트래픽을 전달하는 방식과 유사하게 특정 IP범위로 향하는 트래픽경로를 지정할 수 있다, 경로는 GCP프로젝트내의 VPC네트워크에 적용되며 전역리소스로 간주된다.
    + 전역 작업 : 전역리소스에서 작업을 이행하는 경우 전역 작업으로 간주된다.
* 지역리소스 : 동일한 지역내의 모든 리소스가 액세스할 수 있다.
    + 주소 : 지역 고정 외부 IP주소는 지역리소스이며 주소와 동일한 지역에 있는 인스턴스에서만 사용할 수 있다.
    + 서브넷 : 지역적으로 네트워크를 서브넷으로 구분하고 인스턴스의 내부 IP주소가 할당되는 서브넷을 제어한다.
    + 지역 관리형 인스턴스 그룹 : 지역 관리형 인스턴스 그룹은 여러영역에 걸쳐있는 동종 인스턴스의 모음이다.
    + 지역 영구디스크 : 동일한 지역내의 두 영역 간에 데이터를 영구 저장하고 복제할 수 있다.
    + 지역 작업 : 지역내에 있는 리소스에서 작업을 이행하는 경우 해당작업이 지역별 작업으로 간주된다.
* 영역리소스 : 영역에서 호스팅 되는 리소스를 뜻하며, 해당 영역에서 고유하며 동일한 영역의 리소스에서만 사용할 수 있다.
    + 인스턴스 : 가상머신 인스턴스는 영역내에 상주해야 하며, 같은 영역내의 리소스 또는 전역리소스에 액세스할 수 있다.
    + 영구디스크 : 같은 영역내의 다른 인스턴스에서 액세스 하며, 디스크와 동일한 영역에 있는 인스턴스에만 디스크를 연결할 수 있다.
    + 머신유형 : 영역별 리소스로 인스턴스와 디스크는 동일한 영역에 있는 머신유형만 사용할 수 있다.
    + 영역 관리형 인스턴스 그룹 : 인스턴스 템플릿을 사용하여 단일영역내에 동일한 인스턴스 그룹을 만든다.
    + 영역별 작업 : 영역내에 있는 리소스에서 작업을 이행하는 경우 해당 작업이 영역별 작업으로 간주된다. 
